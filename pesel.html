<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>PESEL</title>
  <style>

  </style>
</head>
<body>

<!-- http://www.algorytm.org/numery-identyfikacyjne/pesel.html -->


<table>
<tr><td>PESEL:</td><td><input id="pesel" type="text"/>
<button id="start">Validate</button>
<tr><td>Year:</td><td><input id="year" type="text"/></td></tr>
<tr><td>Month:</td><td><input id="month" type="text"/></td></tr>
<tr><td>Day:</td><td><input id="day" type="text"/></td></tr>
<tr><td>Sex:</td><td><input id="sex" type="text"/></td></tr>
</table>

<p id="result"></p>

<script>
  const peselInput = document.getElementById("pesel");
  const start = document.getElementById("start");
  const result = document.getElementById("result");
  const resultYear = document.getElementById("year");
  const resultMonth = document.getElementById("month");
  const resultDay = document.getElementById("day");
  const resultSex = document.getElementById("sex");

  start.addEventListener("click", function() {
    let isValid = true;

    const peselValidation = (peselInput) => {

      //indicates the numbers of pesel that mean the checksum
      let checkSum = peselInput.substr(9, 2);
      let sum = peselInput.substring(0, 1) * 1 + peselInput.substring(1, 2) * 3
        + peselInput.substring(2, 3) * 7 + peselInput.substring(3, 4) * 9
        + peselInput.substring(4, 5) * 1 + peselInput.substring(5, 6) * 3
        + peselInput.substring(6, 7) * 7 + peselInput.substring(7, 8) * 9
        + peselInput.substring(8, 9) * 1 + peselInput.substring(9, 10) * 3;

      // checks the checksum
      if ((10-sum ) % 10 == checkSum) {
        return true;
      } else {
        return false;
      }

      // indicates the numbers of pesel that mean year, month, and day of birth
      const year = peselInput.substring(0, 2);
      const month = peselInput.substring(2, 4);
      const day = peselInput.substring(4, 6);

      // cheks numbers added to months in order to recognise the century
      if (month > 80) {
        year += 1800;
        month -= 80;
      } else if(month > 60 && month < 80) {
          year += 2200;
          month -= 60;
      } else if (month > 40 && month < 60) {
          year += 2100;
          month -= 40;
      } else if (month > 20 && month < 40) {
          year += 2000;
          month -= 20;
      } else {
          year += 1900;
      }

      resultYear.innerText = year;
      resultMonth.innerText = month;
      resultDay.innerText = day;

      // indicates the numbers of pesel that mean sex
      let sex = peselInput.substring(6, 10);

      // checks if male or female
      const gender = sex % 2 === 0 ? "female" : "male";

      resultSex.innerText = gender;

    /*  if (sex % 2 == 0) {
        console.log('female');
      } else {
        return 'male';
      } */

    }

    isValid = peselValidation(peselInput.value);

    if(isValid)
      result.innerText = "PESEL is Valid";
    else
      result.innerText = "PESEL is Invalid";
  });


</script>
</body>
</html>
